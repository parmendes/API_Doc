asyncapi: '3.0.0'
info:
  title: Light Measurement API V3
  version: '1.0.0'
  description: Unified API for light measurement events.
  termsOfService: https://www.websitepolicies.com/blog/sample-terms-service-template
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  mosquitto:
    host: amqp://localhost:5672
    protocol: amqp
    description: RabbitMQ server for light measurement events
    security:
    - type: oauth2
      description: OAuth2 authentication for the API
      flows:
        implicit:
          authorizationUrl: https://your-auth-server.com/token
          scopes:
            read:lights: Read street lights
            write:lights: Write street lights
defaultContentType: application/json
channels:
  light.measured:
    address: '#/channels/light.measured'
    messages:
      publishLightMeasuredRequest:
        payload:
          schemaFormat: application/vnd.aai.asyncapi+json;version=3.0.0
          schema:
            Keywords:
            - Type: Object
            - Properties:
                id:
                  Keywords:
                  - Type: String
                  - Value:
                      Key: uuid
                  - Value: Gets/sets the id of the measured light
                  BaseUri: https://json-everything.net/8ca4b8c0c4
                type:
                  Keywords:
                  - Values:
                    - LED
                    - HPS
                  - Value: Gets/sets the type of the measured light
                  BaseUri: https://json-everything.net/4f71a8215d
                lumens:
                  Keywords:
                  - Type: Integer
                  - Value: Gets/sets the specified light's lumens measurement
                  BaseUri: https://json-everything.net/0564018aee
                sentAt:
                  Keywords:
                  - Type: String
                  - Value:
                      Key: date-time
                  - Value: Gets/sets the date and time at which the event has been created
                  BaseUri: https://json-everything.net/b676905e02
                metadata:
                  Keywords:
                  - Type: Object
                  - Schema:
                      Keywords:
                      - Type: String
                      BaseUri: https://json-everything.net/3b8f03dc9b
                  - Value: Gets/sets the event's metadata
                  BaseUri: https://json-everything.net/1d2797d724
            BaseUri: https://json-everything.net/e4dba890e8
      consumeLightMeasuredRequest:
        payload:
          schemaFormat: application/vnd.aai.asyncapi+json;version=3.0.0
          schema:
            Keywords:
            - Type: Object
            - Properties:
                id:
                  Keywords:
                  - Type: String
                  - Value:
                      Key: uuid
                  - Value: Gets/sets the id of the measured light
                  BaseUri: https://json-everything.net/87e98259d1
                type:
                  Keywords:
                  - Values:
                    - LED
                    - HPS
                  - Value: Gets/sets the type of the measured light
                  BaseUri: https://json-everything.net/0b7f2bb0ad
                lumens:
                  Keywords:
                  - Type: Integer
                  - Value: Gets/sets the specified light's lumens measurement
                  BaseUri: https://json-everything.net/ad402532c8
                sentAt:
                  Keywords:
                  - Type: String
                  - Value:
                      Key: date-time
                  - Value: Gets/sets the date and time at which the event has been created
                  BaseUri: https://json-everything.net/1c63692934
                metadata:
                  Keywords:
                  - Type: Object
                  - Schema:
                      Keywords:
                      - Type: String
                      BaseUri: https://json-everything.net/9e189b5c3d
                  - Value: Gets/sets the event's metadata
                  BaseUri: https://json-everything.net/972f262993
            BaseUri: https://json-everything.net/86150cff07
    description: 'This channel is used to exchange messages about lightning measurements.'
    servers:
    - $ref: '#/servers/mosquitto'
    bindings:
      IsReference: true
      $ref: '#/components/channelBindings/amqpBinding'
operations:
  publishLightMeasured:
    action: send
    channel:
      $ref: '#/channels/light.measured'
    description: 'Publishes a light measured event to RabbitMQ.'
    messages:
    - $ref: '#/channels/light.measured/messages/publishLightMeasuredRequest'
    bindings:
      IsReference: true
      $ref: '#/components/operationBindings/amqpOperationBinding'
  consumeLightMeasured:
    action: receive
    channel:
      $ref: '#/channels/light.measured'
    description: 'Consumes a light measured event from RabbitMQ.'
    messages:
    - $ref: '#/channels/light.measured/messages/consumeLightMeasuredRequest'
    bindings:
      IsReference: true
      $ref: '#/components/operationBindings/amqpOperationBinding'
components:
  securitySchemes:
    oauth2:
      type: oauth2
      description: OAuth2 authentication for the API
      flows:
        authorizationCode:
          authorizationUrl: https://your-auth-server.com/token
          tokenUrl: https://your-auth-server.com/token
          scopes:
            read:lights: Read street lights
            write:lights: Write street lights
  serverBindings:
    http:
      http:
        bindingVersion: latest
  channelBindings:
    amqpBinding:
      amqp:
        exchange:
          name: light.measured.exchange
          type: direct
          durable: true
          vhost: /
        queue:
          name: light.measured.queue
          durable: true
          vhost: /
        bindingVersion: 0.3.0
  operationBindings:
    amqpOperationBinding:
      amqp:
        bindingVersion: 0.3.0
